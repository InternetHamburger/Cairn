#include "evaluation.h"
#include "utility.h"
#include "board.h"

int pawn_table[64] = {
        0, 0, 0, 0, 0, 0, 0, 0,
        99, 135, 111, 110, 55, 71, 122, 97,
        77, 93, 108, 94, 104, 96, 103, 71,
        80, 55, 73, 47, 41, 42, 67, 50,
        72, 51, 39, 41, 23, 36, 61, 31,
        31, 52, 34, 45, 37, 54, 46, 34,
        38, 62, 46, 28, 27, 41, 40, 43,
        0, 0, 0, 0, 0, 0, 0, 0,
};

int knight_table[64] = {
        30, 58, 185, 27, 117, 67, 163, 95,
        33, 125, 172, 98, 138, 120, 115, 137,
        105, 167, 107, 137, 115, 154, 176, 165,
        128, 171, 141, 180, 169, 134, 150, 94,
        141, 89, 149, 150, 127, 133, 161, 135,
        140, 161, 144, 136, 154, 153, 113, 128,
        257, 115, 116, 143, 127, 127, 2, 211,
        109, 124, 152, 171, 162, 127, 130, 183,
};

int bishop_table[64] = {
        141, 80, 137, 131, 181, 88, 139, 134,
        135, 156, 126, 255, 121, 130, 94, 168,
        173, 160, 156, 115, 161, 135, 141, 153,
        159, 148, 157, 193, 149, 111, 154, 166,
        113, 176, 166, 157, 180, 168, 145, 162,
        156, 208, 142, 187, 157, 173, 116, 148,
        209, 177, 114, 157, 157, 155, 174, 153,
        198, 124, 146, 107, 76, 159, 114, 205,
};

int rook_table[64] = {
        292, 277, 275, 255, 292, 330, 270, 261,
        261, 282, 262, 271, 285, 291, 269, 280,
        267, 308, 251, 242, 293, 293, 262, 251,
        248, 299, 247, 223, 274, 280, 227, 254,
        244, 233, 236, 241, 282, 283, 280, 258,
        250, 269, 264, 275, 283, 267, 273, 249,
        242, 261, 242, 239, 199, 242, 275, 249,
        254, 251, 259, 246, 257, 257, 249, 247,
};

int queen_table[64] = {
        427, 434, 434, 434, 434, 434, 413, 413,
        431, 434, 434, 426, 431, 434, 434, 434,
        434, 434, 434, 434, 434, 434, 434, 434,
        418, 434, 423, 434, 434, 417, 427, 420,
        425, 426, 434, 423, 434, 389, 411, 434,
        399, 427, 434, 430, 434, 434, 415, 434,
        426, 434, 434, 414, 434, 434, 391, 434,
        434, 434, 407, 421, 434, 334, 434, 434,
};

int king_table[64] = {
        -11, 23, 148, 193, 186, 76, 113, 222,
        17, 13, 106, 94, 43, 67, 13, -15,
        -27, 4, 14, 30, 80, 90, 85, 128,
        -95, -45, -67, 18, 37, 90, 37, 7,
        -11, -3, -7, 10, 11, 108, 24, -78,
        -40, -1, -3, -11, -23, 72, -8, -11,
        -43, -43, -37, -4, -26, -24, 4, -15,
        -26, -49, -45, -27, -7, -18, -38, -25,
};


int piece_square_values[BlackKing + 1][64];

__attribute__((constructor))
static void init_table(void) {
    for (int i = 0; i < 64; i++)
    {
        piece_square_values[WhitePawn][i] = 100;
        piece_square_values[WhiteKnight][i] = 300;
        piece_square_values[WhiteBishop][i] = 300;
        piece_square_values[WhiteRook][i] = 500;
        piece_square_values[WhiteQueen][i] = 900;
        piece_square_values[WhiteKing][i] = 0;

        piece_square_values[BlackPawn][i] = -100;
        piece_square_values[BlackKnight][i] = -300;
        piece_square_values[BlackBishop][i] = -300;
        piece_square_values[BlackRook][i] = -500;
        piece_square_values[BlackQueen][i] = -900;
        piece_square_values[BlackKing][i] = -0;
    }
}

int eval(const Board *board) {
    uint64_t occupied = GetOccupied(board);

    int eval = 0;
    while (occupied){
        const int square = poplsb(&occupied);
        eval += piece_square_values[board->squares[square]][square];
    }
    return eval * (board->white_to_move ? 1 : -1);
}
